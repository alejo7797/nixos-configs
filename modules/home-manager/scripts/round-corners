#! /usr/bin/env nix-shell
#! nix-shell -i bash -p bash imagemagick
# shellcheck shell=bash

# Round off an image's corners,
# e.g. to use as a favicon.

l=$(identify -format "%w" "$1")
r=$(bc <<<"scale=0; $l/${2:-6.4}")

magick -size "${l}x${l}" xc:black \
    -fill white \
    -draw "roundRectangle 0,0,$l,$l $r,$r" \
    .__tmp__mask__.png

magick "$1" .__tmp__mask__.png \
    -alpha Off -compose CopyOpacity \
    -composite "${1%.*}_rounded_corners.png"

rm .__tmp__mask__.png
